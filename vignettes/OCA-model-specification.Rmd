---
title: "OCA-model-specification"
author: "people"
# output: rmarkdown::html_vignette
output:
  pdf_document:
    toc: true
    number_sections: true
header-includes:
  \usepackage{fourier}
vignette: >
  %\VignetteIndexEntry{OCA-model-specification}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Purpose

TODO 

![Model diagram.](model.png)

# demography

$$
\frac{\mathrm{d}}{\mathrm{d}t}N_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)
$$

where $a$ is age, $s$ is sez, $n$ is natal class, $r$ is risk group, $p$ is protection, and $q$ is strain.

$$
\begin{aligned}
& \frac{\mathrm{d}}{\mathrm{d}t}U_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)\\
& \frac{\mathrm{d}}{\mathrm{d}t}E_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)\\
& \frac{\mathrm{d}}{\mathrm{d}t}L_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)\\
& \frac{\mathrm{d}}{\mathrm{d}t}A_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)\\
& \frac{\mathrm{d}}{\mathrm{d}t}D_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)\\
& \frac{\mathrm{d}}{\mathrm{d}t}T_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)
\end{aligned}
$$

TODO other stuff


$$
\begin{aligned}
    & \frac{\mathrm{d}}{\mathrm{d}t}N_{a,s,n,r,p,q}(t) = {b}_{a,s,n,r,p,q}(t) - \bar{\mu}N_{a,s,n,r,p,q}(t)\\
    & N_t(s,a,h,r) = \overbrace{b_t(s)\delta(a)}^{\mathrm{births}} -\overbrace{ \mu^0_t(s,a)N_t(s,a,h,r)}^{\mathrm{background~deaths}} + \overbrace{m_t(s,a)}^{\mathrm{net~migration}}\\
    & -\chi_{h>0}\chi_{r=0}\times\mu^H(s,a,h)N_t(s,a,h,r)\\
    &-\chi_{h>0}\chi_{r>0}\times\mu^A(s,a,h,r)N_t(s,a,h,r)  \\
    & -H(t)\pi^H_t(s,a,h)\left[\chi_{h=r=0} - \chi_{h>0}\right]\\
    & -A(t)\pi^A_t(s,a,h)\left[\chi_{r'=0} - \chi_{r'=1}\right]\\
    & -\chi_{r=0}\left[\chi_{h>0}R^H(s,a,h)N_t(s,a,h,r) - \chi_{h>1}R^H(s,a,h-1)N_t(s,a,h-1,r)\right]\\
    & -\chi_{r>0}\left[R^A(r)N_t(s,a,h,r) -R^A(r-1)N_t(s,a,h,r-1)\right]\label{eqn:artprogn}
\end{aligned}
$$



## yet more

aaa

$$
\begin{aligned}
    & \left(\frac{\partial}{\partial t}+\frac{\partial}{\partial a}\right) N_t(s,a,h,r) = \overbrace{b_t(s)\delta(a)}^{\mathrm{births}} -\overbrace{ \mu^0_t(s,a)N_t(s,a,h,r)}^{\mathrm{background~deaths}} + \overbrace{m_t(s,a)}^{\mathrm{net~migration}}\\
    & -\chi_{h>0}\chi_{r=0}\times\mu^H(s,a,h)N_t(s,a,h,r)\\
    &-\chi_{h>0}\chi_{r>0}\times\mu^A(s,a,h,r)N_t(s,a,h,r)  \\
    & -H(t)\pi^H_t(s,a,h)\left[\chi_{h=r=0} - \chi_{h>0}\right]\\
    & -A(t)\pi^A_t(s,a,h)\left[\chi_{r'=0} - \chi_{r'=1}\right]\\
    & -\chi_{r=0}\left[\chi_{h>0}R^H(s,a,h)N_t(s,a,h,r) - \chi_{h>1}R^H(s,a,h-1)N_t(s,a,h-1,r)\right]\\
    & -\chi_{r>0}\left[R^A(r)N_t(s,a,h,r) -R^A(r-1)N_t(s,a,h,r-1)\right]\label{eqn:artprogn}
\end{aligned}
$$



# Example

```{r setup}
library(OCA1)

## example without nativity class used
pms <- create_demographic_parms(verbose=TRUE) #create UK parameters
```


explanation
```{r}
out <- runmodel(pms)              #run model with these
out                               #inspect
```

explanation
```{r}
## visualize
plt_DemoGrowth(out$state)               #total population over time
```

explanation

```{r,fig.dim = c(8, 6)}
plt_DemoSnapshots(out$state)            #snapshots
```

TODO

- purpose
- strata structure
- TB structure

TODO where to put figures
TODO model figure




$$
\begin{aligned}
    & \left(\frac{\partial}{\partial t}+\frac{\partial}{\partial a}\right) N_t(s,a,h,r) = \overbrace{b_t(s)\delta(a)}^{\mathrm{births}} -\overbrace{ \mu^0_t(s,a)N_t(s,a,h,r)}^{\mathrm{background~deaths}} + \overbrace{m_t(s,a)}^{\mathrm{net~migration}}\\
    & -\chi_{h>0}\chi_{r=0}\times\mu^H(s,a,h)N_t(s,a,h,r)\\
    &-\chi_{h>0}\chi_{r>0}\times\mu^A(s,a,h,r)N_t(s,a,h,r)  \\
    & -H(t)\pi^H_t(s,a,h)\left[\chi_{h=r=0} - \chi_{h>0}\right]\\
    & -A(t)\pi^A_t(s,a,h)\left[\chi_{r'=0} - \chi_{r'=1}\right]\\
    & -\chi_{r=0}\left[\chi_{h>0}R^H(s,a,h)N_t(s,a,h,r) - \chi_{h>1}R^H(s,a,h-1)N_t(s,a,h-1,r)\right]\\
    & -\chi_{r>0}\left[R^A(r)N_t(s,a,h,r) -R^A(r-1)N_t(s,a,h,r-1)\right]\label{eqn:artprogn}
\end{aligned}
$$



And also

$$
\frac{\mathrm{d}}{\mathrm{d}t}X_t(s,a) = {b}_t(s) - \bar{\mu}^0_t(s,a)X_t(s,a)
$$





